# OpenOCD Configuration for BK7258 SoC
# ARM Cortex-M33 with SWD interface

# Debug adapter configuration
source [find interface/cmsis-dap.cfg]

# Transport selection
transport select swd

# Target configuration for ARM Cortex-M33
source [find target/cortex_m.cfg]

# BK7258 specific configuration
set CHIPNAME bk7258
set CPUTAPID 0x6ba02477

# SWD clock frequency (in kHz)
adapter speed 4000

# Target CPU configuration
target create $_CHIPNAME.cpu cortex_m -chain-position $_CHIPNAME.cpu -coreid 0

# Flash configuration for BK7258
# Internal flash: 2MB starting at 0x00000000
flash bank $_CHIPNAME.flash stm32f1x 0x00000000 0x200000 0 0 $_CHIPNAME.cpu

# Enable ARM semihosting
$_CHIPNAME.cpu configure -event reset-init {
    # Configure system clocks and enable debugging features
    mww 0x44000000 0x12345678  # Example register configuration
}

# Reset configuration
reset_config srst_only

# Work area for algorithms (RAM)
$_CHIPNAME.cpu configure -work-area-phys 0x20000000 -work-area-size 0x10000 -work-area-backup 0

# Enable RTT (Real-Time Transfer) if available
rtt setup 0x20000000 0x10000 "SEGGER RTT"
rtt start

# GDB configuration
gdb_port 3333
telnet_port 4444
tcl_port 6666

# Debug output
debug_level 2

# Initialization commands
init
reset init